# FastGPT Agentæ™ºèƒ½ä½“æ·±åº¦åˆ†æ

## ä¸€ã€æ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯Agentæ™ºèƒ½ä½“

åœ¨FastGPTä¸­ï¼Œ**Agentæ™ºèƒ½ä½“**æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œå®ƒä»£è¡¨äº†ä¸€ç§å…·å¤‡**å·¥å…·è°ƒç”¨èƒ½åŠ›**çš„æ™ºèƒ½åº”ç”¨å½¢å¼ã€‚Agentä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„å¯¹è¯æ¨¡å‹ï¼Œè€Œæ˜¯èƒ½å¤Ÿï¼š

- ğŸ¤– **è‡ªä¸»å†³ç­–**ï¼šæ ¹æ®ç”¨æˆ·è¾“å…¥è‡ªä¸»é€‰æ‹©åˆé€‚çš„å·¥å…·
- ğŸ› ï¸ **å·¥å…·è°ƒç”¨**ï¼šè°ƒç”¨å„ç§å·¥å…·ï¼ˆæ•°æ®é›†æœç´¢ã€HTTPè¯·æ±‚ã€ä»£ç æ‰§è¡Œã€MCPå·¥å…·ç­‰ï¼‰æ¥å®Œæˆä»»åŠ¡
- ğŸ”„ **è¿­ä»£æ‰§è¡Œ**ï¼šæ”¯æŒå¤šè½®å·¥å…·è°ƒç”¨ï¼Œç›´åˆ°å®Œæˆä»»åŠ¡
- ğŸ“ **æ™ºèƒ½å“åº”**ï¼šåŸºäºå·¥å…·è¿”å›ç»“æœç”Ÿæˆæœ€ç»ˆå›å¤

### 1.2 Agentåœ¨FastGPTä¸­çš„ä¸¤ç§å½¢å¼

FastGPTä¸­çš„Agentæ¦‚å¿µä½“ç°åœ¨ä¸¤ä¸ªå±‚é¢ï¼š

#### 1. **åº”ç”¨ç±»å‹å±‚é¢** - `AppTypeEnum.agent`
Agentä½œä¸ºä¸€ç§åº”ç”¨ç±»å‹ï¼Œä¸ç®€å•åº”ç”¨(simple)ã€é«˜çº§å·¥ä½œæµ(workflow)å¹¶åˆ—ï¼š

```typescript
export enum AppTypeEnum {
  folder = 'folder',
  simple = 'simple',
  agent = 'agent',        // â† Agentåº”ç”¨ç±»å‹
  workflow = 'advanced',
  // ...
}

export const AppTypeList = [
  AppTypeEnum.simple,   // ç®€å•åº”ç”¨
  AppTypeEnum.agent,    // Agentåº”ç”¨ â­
  AppTypeEnum.workflow  // é«˜çº§å·¥ä½œæµ
];
```

#### 2. **å·¥ä½œæµèŠ‚ç‚¹å±‚é¢** - `FlowNodeTypeEnum.agent`
Agentä½œä¸ºå·¥ä½œæµä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ç±»å‹ï¼Œè´Ÿè´£å·¥å…·è°ƒç”¨ï¼š

```typescript
export enum FlowNodeTypeEnum {
  chatNode = 'chatNode',
  agent = 'tools',      // â† AgentèŠ‚ç‚¹ï¼ˆå·¥å…·è°ƒç”¨èŠ‚ç‚¹ï¼‰â­
  // ...
}
```

**å…³ç³»è¯´æ˜**ï¼š
- **Agentåº”ç”¨** = ä¸€ä¸ªå®Œæ•´çš„æ™ºèƒ½ä½“åº”ç”¨ï¼Œé€šå¸¸å†…éƒ¨åŒ…å«AgentèŠ‚ç‚¹
- **AgentèŠ‚ç‚¹** = å·¥ä½œæµä¸­çš„ä¸€ä¸ªåŠŸèƒ½èŠ‚ç‚¹ï¼Œä¸“é—¨è´Ÿè´£å·¥å…·è°ƒç”¨

---

## äºŒã€Agentåº”ç”¨ç±»å‹åˆ†æ

### 2.1 Agentåº”ç”¨çš„ç‰¹ç‚¹

Agentåº”ç”¨æ˜¯ä¸€ç§**é¢„é…ç½®**çš„åº”ç”¨ç±»å‹ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **å·¥å…·ä¼˜å…ˆ**ï¼šåº”ç”¨çš„æ ¸å¿ƒæ˜¯å·¥å…·è°ƒç”¨èƒ½åŠ›
2. **è‡ªåŠ¨å†³ç­–**ï¼šæ¨¡å‹è‡ªåŠ¨åˆ¤æ–­ä½•æ—¶è°ƒç”¨å“ªä¸ªå·¥å…·
3. **ç®€åŒ–é…ç½®**ï¼šç›¸æ¯”é«˜çº§å·¥ä½œæµï¼Œé…ç½®æ›´ç®€å•
4. **é€‚åˆåœºæ™¯**ï¼šéœ€è¦è°ƒç”¨å¤šä¸ªå·¥å…·ä½†ä¸éœ€è¦å¤æ‚ç¼–æ’é€»è¾‘çš„åœºæ™¯

### 2.2 Agentåº”ç”¨ä¸å…¶ä»–åº”ç”¨ç±»å‹å¯¹æ¯”

| ç‰¹æ€§ | Simpleåº”ç”¨ | Agentåº”ç”¨ | Workflowåº”ç”¨ |
|------|-----------|-----------|-------------|
| **å¤æ‚åº¦** | ç®€å• | ä¸­ç­‰ | é«˜ |
| **å·¥å…·è°ƒç”¨** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒï¼ˆè‡ªåŠ¨ï¼‰ | âœ… æ”¯æŒï¼ˆæ‰‹åŠ¨ç¼–æ’ï¼‰ |
| **å·¥ä½œæµç¼–æ’** | âŒ æ—  | ğŸ”¶ éšå¼ï¼ˆæ¨¡å‹å†³ç­–ï¼‰ | âœ… æ˜¾å¼ï¼ˆèŠ‚ç‚¹è¿æ¥ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | ç®€å•å¯¹è¯ | å·¥å…·è¾…åŠ©å¯¹è¯ | å¤æ‚ä¸šåŠ¡æµç¨‹ |
| **é…ç½®éš¾åº¦** | ä½ | ä¸­ | é«˜ |
| **çµæ´»æ€§** | ä½ | ä¸­ | é«˜ |

### 2.3 Agentåº”ç”¨çš„å†…éƒ¨ç»“æ„

è™½ç„¶ä»£ç ä¸­å®šä¹‰äº†`AppTypeEnum.agent`ï¼Œä½†å®é™…ä¸Š**Agentåº”ç”¨åº•å±‚ä»ç„¶æ˜¯åŸºäºå·¥ä½œæµå®ç°**çš„ã€‚ä¸€ä¸ªAgentåº”ç”¨é€šå¸¸åŒ…å«ï¼š

```
Agentåº”ç”¨
â”œâ”€â”€ å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹ (workflowStart)
â”œâ”€â”€ AgentèŠ‚ç‚¹ (agent/tools)  â† æ ¸å¿ƒèŠ‚ç‚¹
â”‚   â”œâ”€â”€ LLMé…ç½®
â”‚   â”œâ”€â”€ System Prompt
â”‚   â”œâ”€â”€ å·¥å…·è¿æ¥
â”‚   â””â”€â”€ å†å²è®°å½•ç®¡ç†
â”œâ”€â”€ å·¥å…·èŠ‚ç‚¹1 (toolSet/plugin/http...)
â”œâ”€â”€ å·¥å…·èŠ‚ç‚¹2
â””â”€â”€ ...
```

---

## ä¸‰ã€AgentèŠ‚ç‚¹æ·±åº¦åˆ†æ

### 3.1 AgentèŠ‚ç‚¹å®šä¹‰

AgentèŠ‚ç‚¹æ˜¯FastGPTå·¥ä½œæµä¸­æœ€å¼ºå¤§çš„èŠ‚ç‚¹ä¹‹ä¸€ï¼Œå®šä¹‰åœ¨ï¼š
- **æ¨¡æ¿æ–‡ä»¶**ï¼š`packages/global/core/workflow/template/system/agent.ts`
- **æ‰§è¡Œæ–‡ä»¶**ï¼š`packages/service/core/workflow/dispatch/ai/tool/index.ts`

#### èŠ‚ç‚¹æ¨¡æ¿é…ç½®

```typescript
export const AgentNode: FlowNodeTemplateType = {
  id: FlowNodeTypeEnum.agent,
  flowNodeType: FlowNodeTypeEnum.agent,
  templateType: FlowNodeTemplateTypeEnum.ai,  // AIç±»å‹èŠ‚ç‚¹
  showSourceHandle: true,   // æ˜¾ç¤ºè¾“å‡ºè¿æ¥ç‚¹
  showTargetHandle: true,   // æ˜¾ç¤ºè¾“å…¥è¿æ¥ç‚¹
  avatar: 'core/workflow/template/toolCall',
  name: i18nT('workflow:template.agent'),
  intro: i18nT('workflow:template.agent_intro'),
  showStatus: true,
  catchError: false,
  courseUrl: '/docs/introduction/guide/dashboard/workflow/tool/',
  version: '4.9.2',
  
  inputs: [
    // LLMæ¨¡å‹é…ç½®
    { ...Input_Template_SettingAiModel, llmModelType: LLMModelTypeEnum.all },
    
    // LLMå‚æ•°ï¼ˆéšè—é…ç½®ï¼Œåœ¨å¼¹çª—ä¸­è®¾ç½®ï¼‰
    { key: NodeInputKeyEnum.aiChatTemperature, ... },
    { key: NodeInputKeyEnum.aiChatMaxToken, ... },
    { key: NodeInputKeyEnum.aiChatVision, value: true, ... },
    { key: NodeInputKeyEnum.aiChatReasoning, value: true, ... },
    
    // æ ¸å¿ƒè¾“å…¥
    { ...Input_Template_System_Prompt, label: 'Prompt' },
    Input_Template_History,        // å†å²è®°å½•
    Input_Template_File_Link,      // æ–‡ä»¶é“¾æ¥
    Input_Template_UserChatInput   // ç”¨æˆ·è¾“å…¥
  ],
  
  outputs: [
    { 
      id: NodeOutputKeyEnum.answerText,
      label: 'AIå“åº”å†…å®¹',
      valueType: WorkflowIOValueTypeEnum.string
    },
    Output_Template_Error_Message
  ]
};
```

### 3.2 AgentèŠ‚ç‚¹çš„æ ¸å¿ƒèƒ½åŠ›

#### 1. **è‡ªåŠ¨å·¥å…·é€‰æ‹©**
AgentèŠ‚ç‚¹é€šè¿‡LLMçš„function callingèƒ½åŠ›ï¼Œè‡ªåŠ¨å†³å®šï¼š
- æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·
- è°ƒç”¨å“ªä¸ªå·¥å…·
- å·¥å…·çš„å‚æ•°æ˜¯ä»€ä¹ˆ

#### 2. **å¤šå·¥å…·å¹¶è¡Œ/ä¸²è¡Œæ‰§è¡Œ**
æ”¯æŒåŒæ—¶è¿æ¥å¤šä¸ªå·¥å…·èŠ‚ç‚¹ï¼š
- ğŸ“¦ æ•°æ®é›†æœç´¢ (datasetSearch)
- ğŸŒ HTTPè¯·æ±‚ (http468)
- ğŸ“„ æ–‡ä»¶è¯»å– (readFiles)
- ğŸ’» ä»£ç æ‰§è¡Œ (sandbox)
- ğŸ”Œ MCPå·¥å…·é›† (mcpToolSet)
- ğŸ› ï¸ è‡ªå®šä¹‰å·¥å…· (workflowTool)

#### 3. **è¿­ä»£æ‰§è¡Œæœºåˆ¶**
AgentèŠ‚ç‚¹æ”¯æŒå¤šè½®å·¥å…·è°ƒç”¨ï¼š
```
ç”¨æˆ·è¾“å…¥ â†’ Agentæ€è€ƒ â†’ è°ƒç”¨å·¥å…·1 â†’ Agentåˆ†æç»“æœ
         â†’ è°ƒç”¨å·¥å…·2 â†’ Agentç»¼åˆç»“æœ â†’ è¾“å‡ºæœ€ç»ˆç­”æ¡ˆ
```

#### 4. **ä¸Šä¸‹æ–‡ç®¡ç†**
- ä¿æŒå¯¹è¯å†å²
- ç®¡ç†å·¥å…·è°ƒç”¨è®°å½•
- æ”¯æŒæ–‡ä»¶ä¸Šä¼ å’Œå¤„ç†

### 3.3 AgentèŠ‚ç‚¹çš„è¾“å…¥å‚æ•°

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `model` | string | LLMæ¨¡å‹åç§° |
| `systemPrompt` | string | ç³»ç»Ÿæç¤ºè¯ï¼Œå®šä¹‰Agentè¡Œä¸º |
| `temperature` | number | æ¸©åº¦å‚æ•°ï¼ˆ0-2ï¼‰ |
| `maxToken` | number | æœ€å¤§è¾“å‡ºtokenæ•° |
| `isResponseAnswerText` | boolean | æ˜¯å¦è¿”å›æ–‡æœ¬å“åº” |
| `aiChatVision` | boolean | æ˜¯å¦å¯ç”¨è§†è§‰èƒ½åŠ› |
| `aiChatReasoning` | boolean | æ˜¯å¦æ˜¾ç¤ºæ¨ç†è¿‡ç¨‹ |
| `history` | number | å†å²è®°å½•æ•°é‡ |
| `userChatInput` | string | ç”¨æˆ·è¾“å…¥å†…å®¹ |
| `fileUrlList` | array | æ–‡ä»¶é“¾æ¥åˆ—è¡¨ |

### 3.4 AgentèŠ‚ç‚¹çš„è¾“å‡º

| è¾“å‡º | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `answerText` | string | AIæœ€ç»ˆå“åº”å†…å®¹ |
| `error` | string | é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰ |
| `toolDetail` | array | å·¥å…·è°ƒç”¨è¯¦æƒ… |
| `tokens` | number | æ¶ˆè€—çš„tokenæ•° |

---

## å››ã€Agentæ‰§è¡Œæµç¨‹è¯¦è§£

### 4.1 æ‰§è¡Œæµç¨‹æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·å‘èµ·è¯·æ±‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. åˆå§‹åŒ–AgentèŠ‚ç‚¹ (dispatchRunTools)                    â”‚
â”‚     - åŠ è½½LLMæ¨¡å‹                                         â”‚
â”‚     - è·å–å†å²è®°å½•                                         â”‚
â”‚     - æ”¶é›†å·¥å…·èŠ‚ç‚¹                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. æ„å»ºPromptä¸Šä¸‹æ–‡                                      â”‚
â”‚     - System Prompt                                      â”‚
â”‚     - å†å²å¯¹è¯                                            â”‚
â”‚     - å·¥å…·æè¿° (JSON Schema)                             â”‚
â”‚     - ç”¨æˆ·å½“å‰è¾“å…¥                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. LLMæ¨ç† (runToolCall)                                â”‚
â”‚     - å‘é€è¯·æ±‚åˆ°LLM                                       â”‚
â”‚     - LLMå†³ç­–æ˜¯å¦è°ƒç”¨å·¥å…·                                 â”‚
â”‚     â””â”€â†’ ä¸è°ƒç”¨å·¥å…·ï¼šç›´æ¥è¿”å›æ–‡æœ¬å“åº”                       â”‚
â”‚     â””â”€â†’ è°ƒç”¨å·¥å…·ï¼šç”Ÿæˆfunction call                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼ (å¦‚æœéœ€è¦è°ƒç”¨å·¥å…·)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. æ‰§è¡Œå·¥å…·è°ƒç”¨                                          â”‚
â”‚     - è§£æfunction callå‚æ•°                              â”‚
â”‚     - æ‰§è¡Œå¯¹åº”çš„å·¥å…·èŠ‚ç‚¹                                   â”‚
â”‚     - æ”¶é›†å·¥å…·è¿”å›ç»“æœ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. å·¥å…·ç»“æœå¤„ç†                                          â”‚
â”‚     - æ ¼å¼åŒ–å·¥å…·å“åº”                                      â”‚
â”‚     - å°†ç»“æœæ·»åŠ åˆ°ä¸Šä¸‹æ–‡                                   â”‚
â”‚     - å†æ¬¡è°ƒç”¨LLMç”Ÿæˆæœ€ç»ˆå›å¤                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. è¿”å›æœ€ç»ˆå“åº”                                          â”‚
â”‚     - AIç”Ÿæˆçš„æ–‡æœ¬å›å¤                                    â”‚
â”‚     - å·¥å…·è°ƒç”¨è®°å½•                                        â”‚
â”‚     - Tokenæ¶ˆè€—ç»Ÿè®¡                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ ¸å¿ƒæ‰§è¡Œå‡½æ•°ï¼š`dispatchRunTools`

è¯¥å‡½æ•°ä½äº `packages/service/core/workflow/dispatch/ai/tool/index.ts`

#### ä¸»è¦æ­¥éª¤ï¼š

```typescript
export const dispatchRunTools = async (props: DispatchToolModuleProps) => {
  // 1. åˆå§‹åŒ–
  const toolModel = getLLMModel(model);
  const chatHistories = getHistories(history, histories);
  
  // 2. è·å–è¿æ¥çš„å·¥å…·èŠ‚ç‚¹
  const toolNodeIds = filterToolNodeIdByEdges({ nodeId, edges: runtimeEdges });
  const toolNodes = toolNodeIds
    .map(nodeId => runtimeNodes.find(item => item.nodeId === nodeId))
    .filter(Boolean)
    .map(tool => ({
      ...tool,
      toolParams: tool.inputs.filter(input => input.toolDescription)
    }));
  
  // 3. å¤„ç†æ–‡ä»¶è¾“å…¥ï¼ˆå¦‚æœæœ‰readFileså·¥å…·ï¼‰
  const hasReadFilesTool = toolNodes.some(
    item => item.flowNodeType === FlowNodeTypeEnum.readFiles
  );
  const { documentQuoteText, userFiles } = await getMultiInput({
    // ... æ–‡ä»¶å¤„ç†é€»è¾‘
  });
  
  // 4. æ„å»ºæ¶ˆæ¯ä¸Šä¸‹æ–‡
  const messages: ChatItemType[] = [
    ...getSystemPrompt_ChatItemType(concatenateSystemPrompt),
    ...chatHistories,
    { obj: ChatRoleEnum.Human, value: userInput }
  ];
  
  // 5. æ‰§è¡Œå·¥å…·è°ƒç”¨
  const {
    toolWorkflowInteractiveResponse,
    toolDispatchFlowResponses,
    toolCallInputTokens,
    toolCallOutputTokens,
    completeMessages,
    assistantResponses,
    finish_reason
  } = await runToolCall({
    ...props,
    toolNodes,
    messages: adaptMessages
  });
  
  // 6. è¿”å›ç»“æœ
  return {
    [DispatchNodeResponseKeyEnum.answerText]: answerText,
    [DispatchNodeResponseKeyEnum.assistantResponses]: assistantResponses,
    [DispatchNodeResponseKeyEnum.nodeResponse]: {
      totalPoints,
      toolDetail,
      // ...
    }
  };
};
```

### 4.3 å·¥å…·è°ƒç”¨æ ¸å¿ƒï¼š`runToolCall`

ä½äº `packages/service/core/workflow/dispatch/ai/tool/toolCall.ts`

è¿™ä¸ªå‡½æ•°è´Ÿè´£ï¼š
1. **å‘é€è¯·æ±‚åˆ°LLM**ï¼Œæºå¸¦å·¥å…·å®šä¹‰ï¼ˆJSON Schemaï¼‰
2. **è§£æLLMå“åº”**ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰function call
3. **æ‰§è¡Œå·¥å…·**ï¼šå¦‚æœæœ‰function callï¼Œæ‰§è¡Œå¯¹åº”å·¥å…·èŠ‚ç‚¹
4. **è¿­ä»£å¤„ç†**ï¼šæ”¯æŒå¤šè½®å·¥å…·è°ƒç”¨
5. **ç”Ÿæˆæœ€ç»ˆå“åº”**ï¼šåŸºäºå·¥å…·ç»“æœè®©LLMç”Ÿæˆå›å¤

#### å·¥å…·è°ƒç”¨æµç¨‹ï¼š

```typescript
// ä¼ªä»£ç å±•ç¤ºæ ¸å¿ƒé€»è¾‘
async function runToolCall({ toolNodes, messages }) {
  let currentMessages = messages;
  let toolCallHistory = [];
  
  while (true) {
    // 1. è°ƒç”¨LLMï¼ˆå¸¦å·¥å…·å®šä¹‰ï¼‰
    const response = await chatCompletions({
      messages: currentMessages,
      tools: toolNodes.map(tool => convertToFunctionSchema(tool))
    });
    
    // 2. æ£€æŸ¥æ˜¯å¦æœ‰function call
    if (!response.function_call) {
      // æ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œè¿”å›æ–‡æœ¬å“åº”
      return { answerText: response.content };
    }
    
    // 3. æ‰§è¡Œå·¥å…·
    const toolResult = await executeToolNode({
      toolName: response.function_call.name,
      toolParams: response.function_call.arguments
    });
    
    // 4. å°†å·¥å…·ç»“æœæ·»åŠ åˆ°ä¸Šä¸‹æ–‡
    toolCallHistory.push({
      role: 'function',
      name: response.function_call.name,
      content: JSON.stringify(toolResult)
    });
    
    currentMessages = [...currentMessages, ...toolCallHistory];
    
    // 5. æ£€æŸ¥æ˜¯å¦åœæ­¢ï¼ˆè¾¾åˆ°æœ€å¤§è½®æ¬¡æˆ–å·¥å…·è¿”å›åœæ­¢ä¿¡å·ï¼‰
    if (shouldStop(toolResult)) {
      break;
    }
  }
  
  // 6. æœ€åä¸€è½®LLMè°ƒç”¨ï¼Œç”Ÿæˆæœ€ç»ˆå›å¤
  const finalResponse = await chatCompletions({
    messages: currentMessages,
    tools: [] // ä¸å†æä¾›å·¥å…·
  });
  
  return {
    answerText: finalResponse.content,
    toolDetail: toolCallHistory
  };
}
```

---

## äº”ã€Agentå·¥å…·ç”Ÿæ€

### 5.1 FastGPTæ”¯æŒçš„å·¥å…·ç±»å‹

AgentèŠ‚ç‚¹å¯ä»¥è¿æ¥ä»¥ä¸‹ç±»å‹çš„å·¥å…·ï¼š

#### 1. **å†…ç½®ç³»ç»Ÿå·¥å…·**
| å·¥å…·ç±»å‹ | FlowNodeType | åŠŸèƒ½ |
|---------|--------------|------|
| æ•°æ®é›†æœç´¢ | `datasetSearchNode` | ä»çŸ¥è¯†åº“æ£€ç´¢ç›¸å…³å†…å®¹ |
| HTTPè¯·æ±‚ | `httpRequest468` | è°ƒç”¨å¤–éƒ¨API |
| æ–‡ä»¶è¯»å– | `readFiles` | è¯»å–ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹ |
| ä»£ç æ‰§è¡Œ | `sandbox` | æ‰§è¡ŒPython/JavaScriptä»£ç  |
| é—®é¢˜åˆ†ç±» | `classifyQuestion` | å°†ç”¨æˆ·é—®é¢˜åˆ†ç±» |
| å†…å®¹æå– | `contentExtract` | ä»æ–‡æœ¬ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯ |

#### 2. **å·¥ä½œæµå·¥å…·**
- **ç±»å‹**ï¼š`workflowTool` / `plugin`
- **è¯´æ˜**ï¼šå°†å…¶ä»–å·¥ä½œæµå°è£…ä¸ºå·¥å…·
- **ç”¨é€”**ï¼šå¤ç”¨å¤æ‚çš„å·¥ä½œæµé€»è¾‘

#### 3. **MCPå·¥å…·é›†**
- **ç±»å‹**ï¼š`mcpToolSet`
- **è¯´æ˜**ï¼šModel Context Protocolå·¥å…·é›†
- **ç‰¹ç‚¹**ï¼šæ”¯æŒåŠ¨æ€å·¥å…·å‘ç°å’Œè°ƒç”¨

#### 4. **HTTPå·¥å…·é›†**
- **ç±»å‹**ï¼š`httpToolSet`
- **è¯´æ˜**ï¼šæ‰¹é‡HTTPå·¥å…·å®šä¹‰
- **ç”¨é€”**ï¼šå¿«é€Ÿé›†æˆOpenAPIè§„èŒƒçš„æœåŠ¡

### 5.2 å·¥å…·èŠ‚ç‚¹é…ç½®

æ¯ä¸ªå·¥å…·èŠ‚ç‚¹éœ€è¦æä¾›ï¼š

```typescript
// å·¥å…·æè¿°ï¼ˆç”¨äºLLMç†è§£ï¼‰
{
  toolDescription: "æœç´¢çŸ¥è¯†åº“ä¸­çš„ç›¸å…³å†…å®¹",  // å·¥å…·åŠŸèƒ½æè¿°
  
  // å·¥å…·å‚æ•°ï¼ˆJSON Schemaæ ¼å¼ï¼‰
  toolParams: [
    {
      key: "query",
      valueType: "string",
      description: "æœç´¢å…³é”®è¯",
      required: true
    },
    {
      key: "limit",
      valueType: "number",
      description: "è¿”å›ç»“æœæ•°é‡",
      required: false,
      default: 5
    }
  ]
}
```

### 5.3 å·¥å…·è°ƒç”¨ç¤ºä¾‹

#### ç¤ºä¾‹1ï¼šæ•°æ®é›†æœç´¢å·¥å…·

**ç”¨æˆ·è¾“å…¥**ï¼š
```
ç”¨æˆ·: FastGPTæ”¯æŒå“ªäº›æ•°æ®æºï¼Ÿ
```

**Agentæ‰§è¡Œæµç¨‹**ï¼š
```json
// 1. LLMå†³ç­–è°ƒç”¨æ•°æ®é›†æœç´¢å·¥å…·
{
  "function_call": {
    "name": "datasetSearch",
    "arguments": {
      "query": "FastGPTæ•°æ®æºæ”¯æŒ",
      "limit": 5,
      "similarity": 0.5
    }
  }
}

// 2. å·¥å…·æ‰§è¡Œç»“æœ
{
  "result": [
    {
      "content": "FastGPTæ”¯æŒå¤šç§æ•°æ®æºï¼šæœ¬åœ°æ–‡ä»¶ã€ç½‘é¡µé“¾æ¥ã€APIæ•°æ®æº...",
      "score": 0.92
    }
  ]
}

// 3. LLMåŸºäºç»“æœç”Ÿæˆå›å¤
"æ ¹æ®çŸ¥è¯†åº“å†…å®¹ï¼ŒFastGPTæ”¯æŒä»¥ä¸‹æ•°æ®æºï¼š
1. æœ¬åœ°æ–‡ä»¶ï¼ˆæ”¯æŒPDFã€Wordã€TXTç­‰æ ¼å¼ï¼‰
2. ç½‘é¡µé“¾æ¥ï¼ˆè‡ªåŠ¨çˆ¬å–ç½‘é¡µå†…å®¹ï¼‰
3. APIæ•°æ®æºï¼ˆé€šè¿‡APIæ¥å£åŒæ­¥æ•°æ®ï¼‰
..."
```

#### ç¤ºä¾‹2ï¼šå¤šå·¥å…·ååŒ

**ç”¨æˆ·è¾“å…¥**ï¼š
```
ç”¨æˆ·: å¸®æˆ‘æŸ¥è¯¢åŒ—äº¬çš„å¤©æ°”ï¼Œç„¶åæœç´¢çŸ¥è¯†åº“ä¸­å…³äºåŒ—äº¬æ—…æ¸¸çš„æ”»ç•¥
```

**Agentæ‰§è¡Œæµç¨‹**ï¼š
```
Step 1: LLMå†³ç­–è°ƒç”¨HTTPå·¥å…·æŸ¥å¤©æ°”
  â†’ è°ƒç”¨å¤©æ°”API
  â†’ è¿”å›ï¼šåŒ—äº¬ä»Šå¤©æ™´ï¼Œ20-28â„ƒ

Step 2: LLMå†³ç­–è°ƒç”¨æ•°æ®é›†æœç´¢å·¥å…·
  â†’ æœç´¢å…³é”®è¯ï¼šåŒ—äº¬æ—…æ¸¸æ”»ç•¥
  â†’ è¿”å›ï¼šæ•…å®«ã€é•¿åŸç­‰æ™¯ç‚¹ä»‹ç»

Step 3: LLMç»¼åˆä¸¤ä¸ªå·¥å…·ç»“æœç”Ÿæˆå›å¤
  â†’ "åŒ—äº¬ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œæ™´å¤©ï¼Œæ°”æ¸©20-28â„ƒã€‚
      æ ¹æ®æ—…æ¸¸æ”»ç•¥ï¼Œæ¨èæ‚¨ä»Šå¤©æ¸¸è§ˆä»¥ä¸‹æ™¯ç‚¹ï¼š..."
```

---

## å…­ã€Agent Promptç®¡ç†

### 6.1 Agentç›¸å…³Promptå®šä¹‰

FastGPTä¸ºAgentæä¾›äº†ä¸“é—¨çš„Promptæ¨¡æ¿ï¼Œä½äºï¼š
`packages/global/core/ai/prompt/agent.ts`

#### æ ¸å¿ƒPromptï¼š`Prompt_AgentQA`

```typescript
export const Prompt_AgentQA = {
  description: `<Context></Context> æ ‡è®°ä¸­æ˜¯ä¸€æ®µæ–‡æœ¬ï¼Œå­¦ä¹ å’Œåˆ†æå®ƒï¼Œå¹¶æ•´ç†å­¦ä¹ æˆæœï¼š
- æå‡ºé—®é¢˜å¹¶ç»™å‡ºæ¯ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚
- ç­”æ¡ˆéœ€è¯¦ç»†å®Œæ•´ï¼Œå°½å¯èƒ½ä¿ç•™åŸæ–‡æè¿°ï¼Œå¯ä»¥é€‚å½“æ‰©å±•ç­”æ¡ˆæè¿°ã€‚
- ç­”æ¡ˆå¯ä»¥åŒ…å«æ™®é€šæ–‡å­—ã€é“¾æ¥ã€ä»£ç ã€è¡¨æ ¼ã€å…¬å¼ã€åª’ä½“é“¾æ¥ç­‰ Markdown å…ƒç´ ã€‚
- æœ€å¤šæå‡º 50 ä¸ªé—®é¢˜ã€‚
- ç”Ÿæˆçš„é—®é¢˜å’Œç­”æ¡ˆå’Œæºæ–‡æœ¬è¯­è¨€ç›¸åŒã€‚
`,
  fixedText: `è¯·æŒ‰ä»¥ä¸‹æ ¼å¼æ•´ç†å­¦ä¹ æˆæœ:
<Context>
æ–‡æœ¬
</Context>
Q1: é—®é¢˜ã€‚
A1: ç­”æ¡ˆã€‚
Q2:
A2:

------

æˆ‘ä»¬å¼€å§‹å§!

<Context>
{{text}}
</Context>
`
};
```

**ç”¨é€”**ï¼šè¯¥Promptç”¨äºAgentä»æ–‡æ¡£ä¸­å­¦ä¹ å’Œæå–é—®ç­”å¯¹ï¼Œå¸¸ç”¨äºçŸ¥è¯†åº“æ„å»ºåœºæ™¯ã€‚

### 6.2 Agent System Promptæœ€ä½³å®è·µ

åœ¨é…ç½®AgentèŠ‚ç‚¹æ—¶ï¼ŒSystem Promptéå¸¸å…³é”®ï¼Œå®ƒå®šä¹‰äº†Agentçš„ï¼š
- è§’è‰²å®šä½
- è¡Œä¸ºè§„èŒƒ
- å·¥å…·ä½¿ç”¨ç­–ç•¥

#### æ¨èçš„System Promptç»“æ„ï¼š

```markdown
# è§’è‰²å®šä¹‰
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å®¢æœåŠ©æ‰‹ï¼Œè´Ÿè´£å›ç­”ç”¨æˆ·å…³äºäº§å“çš„é—®é¢˜ã€‚

# èƒ½åŠ›æè¿°
ä½ å¯ä»¥è®¿é—®ä»¥ä¸‹å·¥å…·ï¼š
1. çŸ¥è¯†åº“æœç´¢ - æŸ¥è¯¢äº§å“æ–‡æ¡£å’ŒFAQ
2. è®¢å•æŸ¥è¯¢ - æŸ¥è¯¢ç”¨æˆ·è®¢å•ä¿¡æ¯
3. å¤©æ°”æŸ¥è¯¢ - è·å–å®æ—¶å¤©æ°”ä¿¡æ¯

# è¡Œä¸ºè§„èŒƒ
- ä¼˜å…ˆä½¿ç”¨çŸ¥è¯†åº“æœç´¢å·¥å…·æŸ¥æ‰¾å®˜æ–¹ä¿¡æ¯
- å¦‚æœæ‰¾ä¸åˆ°ç­”æ¡ˆï¼Œè¯šå®å‘ŠçŸ¥ç”¨æˆ·
- å›å¤è¦ä¸“ä¸šã€å‹å¥½ã€ç®€æ´
- æ¶‰åŠè®¢å•ä¿¡æ¯æ—¶ï¼Œå…ˆç¡®è®¤ç”¨æˆ·èº«ä»½

# å·¥å…·ä½¿ç”¨ç­–ç•¥
- ç”¨æˆ·é—®äº§å“é—®é¢˜ â†’ ä½¿ç”¨çŸ¥è¯†åº“æœç´¢
- ç”¨æˆ·é—®è®¢å•çŠ¶æ€ â†’ ä½¿ç”¨è®¢å•æŸ¥è¯¢å·¥å…·
- ç”¨æˆ·é—®å¤©æ°” â†’ ä½¿ç”¨å¤©æ°”æŸ¥è¯¢å·¥å…·
- å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªå·¥å…·è·å–å…¨é¢ä¿¡æ¯
```

---

## ä¸ƒã€Agentä¸Workflowçš„å…³ç³»

### 7.1 æ¦‚å¿µåŒºåˆ†

è™½ç„¶Agentåº”ç”¨å’ŒWorkflowåº”ç”¨éƒ½åŸºäºå·¥ä½œæµå¼•æ“ï¼Œä½†å®ƒä»¬çš„å®šä½ä¸åŒï¼š

| ç»´åº¦ | Agentåº”ç”¨ | Workflowåº”ç”¨ |
|------|-----------|--------------|
| **æ ¸å¿ƒç†å¿µ** | AIè‡ªä¸»å†³ç­– | äººå·¥ç¼–æ’æ§åˆ¶ |
| **å·¥å…·è°ƒç”¨** | LLMè‡ªåŠ¨é€‰æ‹© | é¢„å®šä¹‰æµç¨‹ |
| **çµæ´»æ€§** | é«˜ï¼ˆè¿è¡Œæ—¶å†³ç­–ï¼‰ | ä½ï¼ˆå›ºå®šæµç¨‹ï¼‰ |
| **å¯æ§æ€§** | ä½ï¼ˆAIå†³ç­–ï¼‰ | é«˜ï¼ˆæ˜ç¡®è·¯å¾„ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | å¼€æ”¾å¼å¯¹è¯ã€æ™ºèƒ½åŠ©æ‰‹ | ç¡®å®šæ€§æµç¨‹ã€å¤æ‚ä¸šåŠ¡ |

### 7.2 AgentèŠ‚ç‚¹åœ¨Workflowä¸­çš„ä½ç½®

åœ¨é«˜çº§Workflowä¸­ï¼ŒAgentèŠ‚ç‚¹å¯ä»¥ä½œä¸ºå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼š

```
Workflowç¤ºä¾‹ï¼šæ™ºèƒ½å®¢æœç³»ç»Ÿ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·¥ä½œæµå¼€å§‹                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é—®é¢˜åˆ†ç±»èŠ‚ç‚¹ (classifyQuestion)               â”‚
â”‚  - å’¨è¯¢ç±» / æŠ•è¯‰ç±» / è®¢å•ç±»                     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚             â”‚              â”‚
      â–¼             â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AgentèŠ‚ç‚¹â”‚   â”‚ è½¬äººå·¥  â”‚    â”‚ è®¢å•ç³»ç»Ÿ â”‚
â”‚ (å’¨è¯¢)   â”‚   â”‚         â”‚    â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å›å¤ç”¨æˆ·                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 ä½•æ—¶ä½¿ç”¨Agentåº”ç”¨ vs Workflowåº”ç”¨

#### ä½¿ç”¨Agentåº”ç”¨çš„åœºæ™¯ï¼š
âœ… éœ€è¦AIè‡ªä¸»åˆ¤æ–­ä½¿ç”¨å“ªä¸ªå·¥å…·  
âœ… å·¥å…·è°ƒç”¨é¡ºåºä¸å›ºå®š  
âœ… éœ€è¦çµæ´»åº”å¯¹å„ç§ç”¨æˆ·è¾“å…¥  
âœ… å·¥å…·æ•°é‡é€‚ä¸­ï¼ˆ3-10ä¸ªï¼‰  

**å…¸å‹åœºæ™¯**ï¼š
- æ™ºèƒ½å®¢æœåŠ©æ‰‹
- æŠ€æœ¯æ”¯æŒæœºå™¨äºº
- ä¸ªäººåŠ©ç†åº”ç”¨
- æ•°æ®åˆ†æåŠ©æ‰‹

#### ä½¿ç”¨Workflowåº”ç”¨çš„åœºæ™¯ï¼š
âœ… ä¸šåŠ¡æµç¨‹æ˜ç¡®  
âœ… éœ€è¦ä¸¥æ ¼çš„æ‰§è¡Œé¡ºåº  
âœ… éœ€è¦æ¡ä»¶åˆ†æ”¯åˆ¤æ–­  
âœ… æ¶‰åŠå¤æ‚çš„æ•°æ®å¤„ç†  

**å…¸å‹åœºæ™¯**ï¼š
- è®¢å•å¤„ç†æµç¨‹
- å†…å®¹å®¡æ ¸ç³»ç»Ÿ
- æ•°æ®ETLç®¡é“
- å¤šæ­¥éª¤è¡¨å•å¤„ç†

---

## å…«ã€Agentå®ç°çš„æŠ€æœ¯ç»†èŠ‚

### 8.1 Function Callingæœºåˆ¶

FastGPTçš„AgentåŸºäºOpenAIçš„Function Callingæœºåˆ¶å®ç°ï¼š

#### 1. **å·¥å…·å®šä¹‰è½¬æ¢ä¸ºJSON Schema**

```typescript
// å·¥å…·èŠ‚ç‚¹ â†’ Function Schema
{
  name: "datasetSearch",
  description: "æœç´¢çŸ¥è¯†åº“ä¸­çš„ç›¸å…³å†…å®¹",
  parameters: {
    type: "object",
    properties: {
      query: {
        type: "string",
        description: "æœç´¢å…³é”®è¯"
      },
      limit: {
        type: "number",
        description: "è¿”å›ç»“æœæ•°é‡"
      }
    },
    required: ["query"]
  }
}
```

#### 2. **LLMè¯·æ±‚æ ¼å¼**

```typescript
const response = await chatCompletions({
  model: "gpt-4",
  messages: [
    { role: "system", content: systemPrompt },
    { role: "user", content: userInput }
  ],
  tools: [
    { type: "function", function: functionSchema1 },
    { type: "function", function: functionSchema2 }
  ],
  tool_choice: "auto"  // è®©LLMè‡ªåŠ¨å†³ç­–
});
```

#### 3. **LLMå“åº”å¤„ç†**

```typescript
// å“åº”ç±»å‹1ï¼šç›´æ¥æ–‡æœ¬å›å¤
{
  role: "assistant",
  content: "æ ¹æ®æ‚¨çš„é—®é¢˜ï¼Œæˆ‘å»ºè®®..."
}

// å“åº”ç±»å‹2ï¼šè°ƒç”¨å·¥å…·
{
  role: "assistant",
  content: null,
  tool_calls: [
    {
      id: "call_abc123",
      type: "function",
      function: {
        name: "datasetSearch",
        arguments: '{"query":"FastGPTæ•°æ®æº","limit":5}'
      }
    }
  ]
}
```

### 8.2 å·¥å…·æ‰§è¡Œæµç¨‹

```typescript
// 1. è§£æfunction call
const toolCall = response.tool_calls[0];
const toolName = toolCall.function.name;
const toolArgs = JSON.parse(toolCall.function.arguments);

// 2. æŸ¥æ‰¾å¯¹åº”çš„å·¥å…·èŠ‚ç‚¹
const toolNode = toolNodes.find(node => node.name === toolName);

// 3. æ‰§è¡Œå·¥å…·èŠ‚ç‚¹ï¼ˆè°ƒç”¨å¯¹åº”çš„dispatchå‡½æ•°ï¼‰
const toolResult = await executeToolNode({
  node: toolNode,
  params: toolArgs,
  ...dispatchProps
});

// 4. æ ¼å¼åŒ–å·¥å…·ç»“æœ
const formattedResult = {
  role: "tool",
  tool_call_id: toolCall.id,
  content: JSON.stringify(toolResult)
};

// 5. å°†å·¥å…·ç»“æœæ·»åŠ åˆ°æ¶ˆæ¯å†å²
messages.push(response, formattedResult);

// 6. å†æ¬¡è°ƒç”¨LLMç”ŸæˆåŸºäºå·¥å…·ç»“æœçš„å›å¤
const finalResponse = await chatCompletions({
  model: "gpt-4",
  messages: messages
});
```

### 8.3 é”™è¯¯å¤„ç†æœºåˆ¶

```typescript
try {
  // æ‰§è¡Œå·¥å…·
  const result = await executeToolNode(toolNode);
} catch (error) {
  // å°†é”™è¯¯ä¿¡æ¯è¿”å›ç»™LLM
  const errorMessage = {
    role: "tool",
    tool_call_id: toolCall.id,
    content: JSON.stringify({
      error: true,
      message: error.message
    })
  };
  
  // LLMä¼šæ ¹æ®é”™è¯¯ä¿¡æ¯è°ƒæ•´ç­–ç•¥
  // ä¾‹å¦‚ï¼šå°è¯•å…¶ä»–å·¥å…·ã€å‘ç”¨æˆ·è¯´æ˜é—®é¢˜ç­‰
}
```

### 8.4 Tokenç®¡ç†å’Œæˆæœ¬æ§åˆ¶

```typescript
// Tokenç»Ÿè®¡
const usage = {
  // LLMè°ƒç”¨token
  toolCallInputTokens: 0,
  toolCallOutputTokens: 0,
  
  // å·¥å…·èŠ‚ç‚¹å†…éƒ¨tokenï¼ˆå¦‚æ•°æ®é›†æœç´¢çš„embeddingï¼‰
  embeddingTokens: 0,
  
  // æ€»è®¡
  totalTokens: 0
};

// æˆæœ¬è®¡ç®—
const totalPoints = formatModelChars2Points({
  model: toolModel,
  tokens: usage.totalTokens,
  inputTokens: usage.toolCallInputTokens,
  outputTokens: usage.toolCallOutputTokens
});
```

---

## ä¹ã€Agentæ€§èƒ½ä¼˜åŒ–

### 9.1 ä¼˜åŒ–ç­–ç•¥

#### 1. **ç²¾ç®€å·¥å…·æè¿°**
- âŒ å†—é•¿çš„å·¥å…·æè¿°ä¼šæ¶ˆè€—å¤§é‡token
- âœ… ç®€æ´æ˜ç¡®çš„æè¿°ï¼Œçªå‡ºå…³é”®å‚æ•°

```typescript
// ä¸å¥½çš„æè¿°
"è¿™æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ•°æ®é›†æœç´¢å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®ä½ åœ¨çŸ¥è¯†åº“ä¸­æŸ¥æ‰¾ç›¸å…³å†…å®¹ï¼Œ
æ”¯æŒå¤šç§æœç´¢æ¨¡å¼ï¼ŒåŒ…æ‹¬å‘é‡æœç´¢ã€å…¨æ–‡æœç´¢ã€æ··åˆæœç´¢ç­‰ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒæ•´
ç›¸ä¼¼åº¦é˜ˆå€¼æ¥æ§åˆ¶æœç´¢ç²¾åº¦..."

// å¥½çš„æè¿°
"æœç´¢çŸ¥è¯†åº“å†…å®¹ã€‚å‚æ•°ï¼šquery(å…³é”®è¯), limit(ç»“æœæ•°é‡)"
```

#### 2. **æ§åˆ¶å†å²è®°å½•é•¿åº¦**
```typescript
// å»ºè®®é…ç½®
{
  history: 6  // ä¿ç•™æœ€è¿‘6è½®å¯¹è¯ï¼Œå¹³è¡¡ä¸Šä¸‹æ–‡å’Œtokenæ¶ˆè€—
}
```

#### 3. **å·¥å…·èŠ‚ç‚¹ç¼“å­˜**
å¯¹äºé¢‘ç¹è°ƒç”¨çš„å·¥å…·ï¼Œè€ƒè™‘æ·»åŠ ç¼“å­˜å±‚ï¼š
```typescript
// ä¾‹å¦‚ï¼šæ•°æ®é›†æœç´¢ç»“æœç¼“å­˜
const cacheKey = `search:${query}:${limit}`;
const cachedResult = await redis.get(cacheKey);
if (cachedResult) {
  return JSON.parse(cachedResult);
}
```

#### 4. **å¹¶è¡Œå·¥å…·æ‰§è¡Œ**
å¦‚æœå·¥å…·ä¹‹é—´æ— ä¾èµ–ï¼Œå¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼š
```typescript
// ä¸²è¡Œæ‰§è¡Œï¼ˆæ…¢ï¼‰
const result1 = await executeTool1();
const result2 = await executeTool2();

// å¹¶è¡Œæ‰§è¡Œï¼ˆå¿«ï¼‰
const [result1, result2] = await Promise.all([
  executeTool1(),
  executeTool2()
]);
```

### 9.2 ç›‘æ§æŒ‡æ ‡

å»ºè®®ç›‘æ§ä»¥ä¸‹æŒ‡æ ‡ï¼š

```typescript
{
  // æ‰§è¡Œæ—¶é—´
  duration: 3500,  // ms
  
  // Tokenæ¶ˆè€—
  inputTokens: 1200,
  outputTokens: 500,
  
  // å·¥å…·è°ƒç”¨
  toolCallCount: 2,
  toolCallSuccess: 2,
  toolCallFailed: 0,
  
  // æˆæœ¬
  totalPoints: 120,
  
  // ç”¨æˆ·ä½“éªŒ
  firstTokenTime: 800,  // é¦–ä¸ªtokenè¿”å›æ—¶é—´
  avgLatency: 1750      // å¹³å‡å»¶è¿Ÿ
}
```

---

## åã€Agentä½¿ç”¨æœ€ä½³å®è·µ

### 10.1 è®¾è®¡åŸåˆ™

#### 1. **å·¥å…·ç²’åº¦é€‚ä¸­**
- âŒ å·¥å…·åŠŸèƒ½å¤ªå¤§ï¼šéš¾ä»¥è¢«LLMæ­£ç¡®ä½¿ç”¨
- âŒ å·¥å…·åŠŸèƒ½å¤ªå°ï¼šéœ€è¦å¤šæ¬¡è°ƒç”¨ï¼Œæµªè´¹token
- âœ… ä¸€ä¸ªå·¥å…·å®Œæˆä¸€ä¸ªæ˜ç¡®çš„ä»»åŠ¡

#### 2. **æ¸…æ™°çš„å·¥å…·å‘½å**
```typescript
// ä¸å¥½çš„å‘½å
"tool1", "func_abc", "helper"

// å¥½çš„å‘½å
"searchDataset", "queryWeather", "sendEmail"
```

#### 3. **åˆç†çš„System Prompt**
- æ˜ç¡®å‘Šè¯‰Agentä»€ä¹ˆæ—¶å€™ä½¿ç”¨ä»€ä¹ˆå·¥å…·
- æä¾›å·¥å…·ä½¿ç”¨çš„ç¤ºä¾‹
- è®¾å®šå·¥å…·ä½¿ç”¨çš„ä¼˜å…ˆçº§

#### 4. **é”™è¯¯åé¦ˆæœºåˆ¶**
å·¥å…·æ‰§è¡Œå¤±è´¥æ—¶ï¼Œè¿”å›å¯¹LLMå‹å¥½çš„é”™è¯¯ä¿¡æ¯ï¼š
```json
{
  "success": false,
  "error": "æœªæ‰¾åˆ°ç›¸å…³å†…å®¹",
  "suggestion": "è¯·å°è¯•ä½¿ç”¨å…¶ä»–å…³é”®è¯æœç´¢"
}
```

### 10.2 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### é—®é¢˜1ï¼šAgentä¸è°ƒç”¨å·¥å…·
**åŸå› **ï¼š
- System Promptæ²¡æœ‰æ˜ç¡®è¯´æ˜å·¥å…·çš„ä½œç”¨
- å·¥å…·æè¿°ä¸å¤Ÿæ¸…æ™°
- ç”¨æˆ·è¾“å…¥ä¸æ˜ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
```markdown
åœ¨System Promptä¸­æ˜ç¡®è¯´æ˜ï¼š
"å½“ç”¨æˆ·è¯¢é—®äº§å“ä¿¡æ¯æ—¶ï¼Œä½ å¿…é¡»ä½¿ç”¨çŸ¥è¯†åº“æœç´¢å·¥å…·æŸ¥æ‰¾ç­”æ¡ˆï¼Œ
ä¸è¦å‡­æƒ³è±¡å›ç­”ã€‚"
```

#### é—®é¢˜2ï¼šAgentè°ƒç”¨é”™è¯¯çš„å·¥å…·
**åŸå› **ï¼š
- å¤šä¸ªå·¥å…·æè¿°ç›¸ä¼¼
- å·¥å…·å‚æ•°å®šä¹‰ä¸æ¸…æ™°

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å·®å¼‚åŒ–å·¥å…·æè¿°
- åœ¨descriptionä¸­è¯´æ˜ä½¿ç”¨åœºæ™¯
```typescript
{
  name: "searchProduct",
  description: "æœç´¢äº§å“ä¿¡æ¯ï¼ˆåç§°ã€ä»·æ ¼ã€è§„æ ¼ï¼‰ã€‚ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·è¯¢é—®äº§å“è¯¦æƒ…æ—¶"
}
```

#### é—®é¢˜3ï¼šTokenæ¶ˆè€—è¿‡é«˜
**åŸå› **ï¼š
- å†å²è®°å½•è¿‡é•¿
- å·¥å…·æè¿°å†—ä½™
- å¤šæ¬¡è¿­ä»£è°ƒç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é™åˆ¶historyå‚æ•°ï¼ˆå»ºè®®6-10ï¼‰
- ç²¾ç®€å·¥å…·æè¿°å’ŒSystem Prompt
- åœ¨å·¥å…·è¿”å›æ—¶æ˜ç¡®æ ‡è®°ä»»åŠ¡å®Œæˆ

#### é—®é¢˜4ï¼šå“åº”é€Ÿåº¦æ…¢
**åŸå› **ï¼š
- å·¥å…·æ‰§è¡Œè€—æ—¶ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰
- å¤šè½®è¿­ä»£
- LLMæ¨ç†æ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¼˜åŒ–å·¥å…·èŠ‚ç‚¹æ€§èƒ½
- ä½¿ç”¨streamingå“åº”
- è€ƒè™‘ä½¿ç”¨æ›´å¿«çš„æ¨¡å‹ï¼ˆå¦‚gpt-3.5-turboï¼‰

### 10.3 æµ‹è¯•å’Œè°ƒè¯•

#### 1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
```typescript
// åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨å·¥å…·è°ƒç”¨æ—¥å¿—
{
  mode: 'debug',
  responseDetail: true,  // è¿”å›å·¥å…·è°ƒç”¨è¯¦æƒ…
  showNodeStatus: true   // æ˜¾ç¤ºèŠ‚ç‚¹æ‰§è¡ŒçŠ¶æ€
}
```

#### 2. **å•å…ƒæµ‹è¯•å·¥å…·èŠ‚ç‚¹**
```typescript
// æµ‹è¯•å·¥å…·èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œ
describe('Dataset Search Tool', () => {
  it('should return relevant results', async () => {
    const result = await executeToolNode({
      node: datasetSearchNode,
      params: { query: 'FastGPT', limit: 5 }
    });
    
    expect(result.success).toBe(true);
    expect(result.data.length).toBeGreaterThan(0);
  });
});
```

#### 3. **ç›‘æ§Agentå†³ç­–**
è®°å½•Agentçš„å·¥å…·è°ƒç”¨å†³ç­–ï¼š
```typescript
{
  userInput: "FastGPTæ”¯æŒå“ªäº›åŠŸèƒ½ï¼Ÿ",
  agentDecision: {
    action: "call_tool",
    tool: "searchDataset",
    reasoning: "ç”¨æˆ·è¯¢é—®åŠŸèƒ½ï¼Œéœ€è¦æŸ¥è¯¢çŸ¥è¯†åº“"
  },
  toolResult: { ... },
  finalResponse: "FastGPTæ”¯æŒä»¥ä¸‹åŠŸèƒ½ï¼š..."
}
```

---

## åä¸€ã€Agentæ‰©å±•å’Œå®šåˆ¶

### 11.1 è‡ªå®šä¹‰Agentå·¥å…·

#### æ–¹å¼1ï¼šåˆ›å»ºå·¥ä½œæµå·¥å…·

1. åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œæµåº”ç”¨
2. é…ç½®è¾“å…¥è¾“å‡ºå‚æ•°
3. æ·»åŠ toolDescription
4. åœ¨AgentèŠ‚ç‚¹ä¸­è¿æ¥è¯¥å·¥å…·

#### æ–¹å¼2ï¼šå¼€å‘MCPå·¥å…·

```typescript
// MCPå·¥å…·ç¤ºä¾‹
export const customMCPTool = {
  name: "getStockPrice",
  description: "è·å–è‚¡ç¥¨å®æ—¶ä»·æ ¼",
  inputSchema: {
    type: "object",
    properties: {
      symbol: {
        type: "string",
        description: "è‚¡ç¥¨ä»£ç "
      }
    },
    required: ["symbol"]
  },
  handler: async ({ symbol }) => {
    // å®ç°å·¥å…·é€»è¾‘
    const price = await fetchStockPrice(symbol);
    return { success: true, price };
  }
};
```

### 11.2 Agentæ¨¡æ¿

å¯ä»¥åˆ›å»ºé¢„é…ç½®çš„Agentæ¨¡æ¿ï¼š

```typescript
// å®¢æœAgentæ¨¡æ¿
export const customerServiceAgentTemplate = {
  name: "æ™ºèƒ½å®¢æœ",
  systemPrompt: `ä½ æ˜¯ä¸“ä¸šçš„å®¢æœåŠ©æ‰‹...`,
  tools: [
    "searchDataset",    // çŸ¥è¯†åº“æœç´¢
    "queryOrder",       // è®¢å•æŸ¥è¯¢
    "createTicket"      // åˆ›å»ºå·¥å•
  ],
  settings: {
    temperature: 0.7,
    maxToken: 2000,
    history: 6
  }
};

// æ•°æ®åˆ†æAgentæ¨¡æ¿
export const dataAnalystAgentTemplate = {
  name: "æ•°æ®åˆ†æå¸ˆ",
  systemPrompt: `ä½ æ˜¯æ•°æ®åˆ†æä¸“å®¶...`,
  tools: [
    "executeSQL",       // æ‰§è¡ŒSQL
    "generateChart",    // ç”Ÿæˆå›¾è¡¨
    "runPython"         // è¿è¡ŒPythonä»£ç 
  ],
  settings: {
    temperature: 0.3,
    maxToken: 4000
  }
};
```

---

## åäºŒã€æ€»ç»“

### 12.1 æ ¸å¿ƒè¦ç‚¹

1. **Agentæ˜¯ä»€ä¹ˆ**ï¼š
   - åº”ç”¨ç±»å‹ï¼šå…·å¤‡å·¥å…·è°ƒç”¨èƒ½åŠ›çš„æ™ºèƒ½åº”ç”¨
   - å·¥ä½œæµèŠ‚ç‚¹ï¼šè´Ÿè´£å·¥å…·è°ƒç”¨çš„æ ¸å¿ƒèŠ‚ç‚¹

2. **Agentçš„æ ¸å¿ƒèƒ½åŠ›**ï¼š
   - ğŸ¤– è‡ªä¸»å†³ç­–é€‰æ‹©å·¥å…·
   - ğŸ› ï¸ æ”¯æŒå¤šç§å·¥å…·ç±»å‹
   - ğŸ”„ è¿­ä»£æ‰§è¡Œç›´åˆ°å®Œæˆä»»åŠ¡
   - ğŸ“ åŸºäºå·¥å…·ç»“æœç”Ÿæˆå›å¤

3. **æŠ€æœ¯å®ç°**ï¼š
   - åŸºäºLLMçš„Function Calling
   - å·¥ä½œæµå¼•æ“æ”¯æ’‘
   - JSON Schemaå·¥å…·å®šä¹‰
   - ä¸Šä¸‹æ–‡ç®¡ç†å’ŒçŠ¶æ€ç»´æŠ¤

4. **ä½¿ç”¨åœºæ™¯**ï¼š
   - âœ… æ™ºèƒ½å®¢æœã€æŠ€æœ¯æ”¯æŒ
   - âœ… ä¸ªäººåŠ©ç†ã€æ•°æ®åˆ†æ
   - âœ… éœ€è¦å·¥å…·è¾…åŠ©çš„å¯¹è¯åœºæ™¯
   - âŒ ä¸¥æ ¼æµç¨‹æ§åˆ¶çš„ä¸šåŠ¡åœºæ™¯

### 12.2 æ¶æ„å±‚æ¬¡

```
FastGPT Agentæ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          åº”ç”¨å±‚ (AppTypeEnum.agent)          â”‚
â”‚          - Agentåº”ç”¨å®šä¹‰                     â”‚
â”‚          - ç”¨æˆ·é…ç½®ç•Œé¢                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å·¥ä½œæµå±‚ (Agent Node)               â”‚
â”‚          - AgentèŠ‚ç‚¹æ¨¡æ¿                     â”‚
â”‚          - å·¥å…·è¿æ¥ç®¡ç†                       â”‚
â”‚          - æ‰§è¡Œæµç¨‹æ§åˆ¶                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ‰§è¡Œå±‚ (dispatchRunTools)           â”‚
â”‚          - LLMè°ƒç”¨                           â”‚
â”‚          - å·¥å…·æ‰§è¡Œ                           â”‚
â”‚          - ç»“æœå¤„ç†                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å·¥å…·å±‚ (Tool Nodes)                 â”‚
â”‚          - æ•°æ®é›†æœç´¢                         â”‚
â”‚          - HTTPè¯·æ±‚                          â”‚
â”‚          - ä»£ç æ‰§è¡Œ                           â”‚
â”‚          - MCPå·¥å…·                           â”‚
â”‚          - ...                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.3 æœªæ¥å±•æœ›

FastGPTçš„Agentèƒ½åŠ›è¿˜åœ¨ä¸æ–­æ¼”è¿›ï¼Œæœªæ¥å¯èƒ½çš„æ–¹å‘ï¼š

1. **å¤šAgentåä½œ**ï¼šæ”¯æŒå¤šä¸ªAgentç›¸äº’åä½œå®Œæˆå¤æ‚ä»»åŠ¡
2. **Agentè®°å¿†ç³»ç»Ÿ**ï¼šé•¿æœŸè®°å¿†å’Œå­¦ä¹ èƒ½åŠ›
3. **æ›´æ™ºèƒ½çš„å·¥å…·é€‰æ‹©**ï¼šåŸºäºå†å²æ•°æ®ä¼˜åŒ–å·¥å…·æ¨è
4. **Agentå¸‚åœº**ï¼šé¢„é…ç½®çš„Agentæ¨¡æ¿å¸‚åœº
5. **è§†è§‰Agent**ï¼šæ”¯æŒå›¾åƒç†è§£å’Œç”Ÿæˆçš„Agent

---

## é™„å½•

### A. ç›¸å…³æ–‡ä»¶ç´¢å¼•

#### æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `packages/global/core/app/constants.ts` | åº”ç”¨ç±»å‹å®šä¹‰ |
| `packages/global/core/workflow/node/constant.ts` | èŠ‚ç‚¹ç±»å‹å®šä¹‰ |
| `packages/global/core/workflow/template/system/agent.ts` | AgentèŠ‚ç‚¹æ¨¡æ¿ |
| `packages/service/core/workflow/dispatch/ai/tool/index.ts` | Agentæ‰§è¡Œé€»è¾‘ |
| `packages/service/core/workflow/dispatch/ai/tool/toolCall.ts` | å·¥å…·è°ƒç”¨æ ¸å¿ƒ |
| `packages/global/core/ai/prompt/agent.ts` | Agentç›¸å…³Prompt |

#### å·¥å…·ç›¸å…³

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `packages/service/core/workflow/dispatch/tools/` | å„ç±»å·¥å…·å®ç° |
| `packages/service/core/workflow/dispatch/ai/tool/type.d.ts` | å·¥å…·ç±»å‹å®šä¹‰ |
| `packages/global/core/app/tool/` | å·¥å…·é…ç½®å’Œç±»å‹ |

### B. æœ¯è¯­è¡¨

| æœ¯è¯­ | è‹±æ–‡ | è¯´æ˜ |
|------|------|------|
| Agent | Agent | æ™ºèƒ½ä½“ï¼Œå…·å¤‡å·¥å…·è°ƒç”¨èƒ½åŠ›çš„AIåº”ç”¨ |
| Function Calling | Function Calling | LLMçš„å‡½æ•°è°ƒç”¨èƒ½åŠ› |
| Tool | Tool | å·¥å…·ï¼ŒAgentå¯ä»¥è°ƒç”¨çš„åŠŸèƒ½æ¨¡å— |
| Tool Node | Tool Node | å·¥å…·èŠ‚ç‚¹ï¼Œå·¥ä½œæµä¸­çš„å·¥å…·å®ç° |
| Workflow | Workflow | å·¥ä½œæµï¼ŒèŠ‚ç‚¹ç¼–æ’çš„æ‰§è¡Œæµç¨‹ |
| Dispatch | Dispatch | è°ƒåº¦ï¼ŒèŠ‚ç‚¹æ‰§è¡Œçš„è°ƒåº¦é€»è¾‘ |
| MCP | Model Context Protocol | æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼Œå·¥å…·å®šä¹‰æ ‡å‡† |

### C. å‚è€ƒèµ„æº

- [FastGPTå®˜æ–¹æ–‡æ¡£ - å·¥å…·è°ƒç”¨](https://doc.fastgpt.in/docs/development/custom-plugin/)
- [OpenAI Function Callingæ–‡æ¡£](https://platform.openai.com/docs/guides/function-calling)
- [Model Context Protocolè§„èŒƒ](https://modelcontextprotocol.io/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024-12-09  
**é€‚ç”¨ç‰ˆæœ¬**: FastGPT v4.9.2+
