# FastGPT å¯¹è¯ç®¡ç†æ¨¡å—æ–‡æ¡£

## ğŸ“š æ–‡æ¡£æ¦‚è§ˆ

æœ¬ç›®å½•åŒ…å« FastGPT å¯¹è¯ç®¡ç†æ¨¡å—çš„æ·±åº¦åˆ†ææ–‡æ¡£ï¼Œæ¶µç›–å¯¹è¯ä¼šè¯ã€æ¶ˆæ¯å­˜å‚¨ã€åé¦ˆç³»ç»Ÿç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸ“– æ ¸å¿ƒæ–‡æ¡£

### [chat-management.md](./chat-management.md)
**ä¸»æ–‡æ¡£** - å¯¹è¯ç®¡ç†æ¨¡å—å®Œæ•´åˆ†æ

**æ–‡æ¡£ç« èŠ‚**:
1. æ¨¡å—æ¦‚è¿° - å¯¹è¯ç®¡ç†çš„æ ¸å¿ƒèŒè´£
2. æ•°æ®æ¨¡å‹è®¾è®¡ - Chat/ChatItem Schema
3. å¯¹è¯æ¥æºç±»å‹ - å¤šç§å¯¹è¯å…¥å£
4. æ¶ˆæ¯ç±»å‹ä½“ç³» - ç”¨æˆ·/AI/ç³»ç»Ÿæ¶ˆæ¯
5. å¯¹è¯æµç¨‹ - ä»å‘èµ·åˆ°å­˜å‚¨
6. åé¦ˆç³»ç»Ÿ - ç”¨æˆ·åé¦ˆä¸ç®¡ç†å‘˜å¤„ç†
7. API æ¥å£ - å¯¹è¯ç›¸å…³API
8. æ€§èƒ½ä¼˜åŒ– - å¯¹è¯å­˜å‚¨ä¼˜åŒ–

## ğŸ–¼ï¸ æ¶æ„å›¾

### [chat-architecture.puml](./chat-architecture.puml)
**ç»„ä»¶æ¶æ„å›¾** - å±•ç¤ºå¯¹è¯ç®¡ç†ç³»ç»Ÿçš„åˆ†å±‚æ¶æ„

### [chat-flow-sequence.puml](./chat-flow-sequence.puml)  
**å¯¹è¯æµç¨‹æ—¶åºå›¾** - å±•ç¤ºå®Œæ•´å¯¹è¯æµç¨‹

## ğŸ¯ å¿«é€Ÿå¯¼èˆª

### åœºæ™¯1: äº†è§£å¯¹è¯æ•°æ®ç»“æ„

**æ¨èé˜…è¯»è·¯å¾„**:
1. ğŸ“– [chat-management.md - ç¬¬äºŒç« ï¼šæ•°æ®æ¨¡å‹](./chat-management.md#äºŒæ•°æ®æ¨¡å‹è®¾è®¡)
2. ğŸ“– [chat-management.md - ç¬¬å››ç« ï¼šæ¶ˆæ¯ç±»å‹](./chat-management.md#å››æ¶ˆæ¯ç±»å‹ä½“ç³»)

**å…³é”®è¦ç‚¹**:
- Chat: å¯¹è¯ä¼šè¯å®¹å™¨
- ChatItem: å•æ¡æ¶ˆæ¯è®°å½•
- æ¶ˆæ¯å†…å®¹æ”¯æŒå¤šç§ç±»å‹

### åœºæ™¯2: ç†è§£å¯¹è¯æ¥æº

**æ¨èé˜…è¯»è·¯å¾„**:
1. ğŸ“– [chat-management.md - ç¬¬ä¸‰ç« ï¼šå¯¹è¯æ¥æº](./chat-management.md#ä¸‰å¯¹è¯æ¥æºç±»å‹)

**å¯¹è¯æ¥æº**:
- test: æµ‹è¯•å¯¹è¯
- online: åœ¨çº¿å¯¹è¯
- api: APIè°ƒç”¨
- share: åˆ†äº«é“¾æ¥
- ç¬¬ä¸‰æ–¹é›†æˆ: é£ä¹¦/ä¼å¾®/å…¬ä¼—å·

### åœºæ™¯3: é›†æˆå¯¹è¯åŠŸèƒ½

**æ¨èé˜…è¯»è·¯å¾„**:
1. ğŸ“– [chat-management.md - ç¬¬ä¸ƒç« ï¼šAPIæ¥å£](./chat-management.md#ä¸ƒapiæ¥å£)
2. ğŸ–¼ï¸ [å¯¹è¯æµç¨‹æ—¶åºå›¾](./chat-flow-sequence.puml)

## ğŸ”§ ä»£ç ä½ç½®ç´¢å¼•

| åŠŸèƒ½æ¨¡å— | æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|---------|------|
| å¯¹è¯å¸¸é‡ | `packages/global/core/chat/constants.ts` | ChatRoleEnum, ChatSourceEnum |
| å¯¹è¯ç±»å‹ | `packages/global/core/chat/type.d.ts` | ç±»å‹å£°æ˜ |
| ä¼šè¯Schema | `packages/service/core/chat/chatSchema.ts` | MongoDB Schema |
| æ¶ˆæ¯Schema | `packages/service/core/chat/chatItemSchema.ts` | æ¶ˆæ¯å­˜å‚¨ |
| æ§åˆ¶å™¨ | `packages/service/core/chat/controller.ts` | ä¸šåŠ¡é€»è¾‘ |
| ä¿å­˜å¯¹è¯ | `packages/service/core/chat/saveChat.ts` | å¯¹è¯æŒä¹…åŒ– |
| APIè·¯ç”± | `projects/app/src/pages/api/core/chat/` | å¯¹è¯API |

## ğŸ“Š æ ¸å¿ƒæ¦‚å¿µé€ŸæŸ¥

### å¯¹è¯è§’è‰²

| è§’è‰² | æšä¸¾å€¼ | è¯´æ˜ |
|------|--------|------|
| ç³»ç»Ÿ | `System` | ç³»ç»Ÿæç¤ºæ¶ˆæ¯ |
| ç”¨æˆ· | `Human` | ç”¨æˆ·è¾“å…¥æ¶ˆæ¯ |
| AI | `AI` | AIå›å¤æ¶ˆæ¯ |

### å¯¹è¯æ¥æº

| æ¥æº | æšä¸¾å€¼ | è¯´æ˜ |
|------|--------|------|
| æµ‹è¯• | `test` | è°ƒè¯•æµ‹è¯•å¯¹è¯ |
| åœ¨çº¿ | `online` | æ­£å¼åœ¨çº¿å¯¹è¯ |
| åˆ†äº« | `share` | åˆ†äº«é“¾æ¥å¯¹è¯ |
| API | `api` | APIè°ƒç”¨å¯¹è¯ |
| å®šæ—¶ä»»åŠ¡ | `cronJob` | å®šæ—¶è§¦å‘å¯¹è¯ |
| å›¢é˜Ÿ | `team` | å›¢é˜Ÿåä½œå¯¹è¯ |
| é£ä¹¦ | `feishu` | é£ä¹¦é›†æˆ |
| ä¼å¾® | `wecom` | ä¼ä¸šå¾®ä¿¡é›†æˆ |
| å…¬ä¼—å· | `official_account` | å¾®ä¿¡å…¬ä¼—å· |
| MCP | `mcp` | MCPè°ƒç”¨ |

### æ¶ˆæ¯å†…å®¹ç±»å‹

| ç±»å‹ | æšä¸¾å€¼ | è¯´æ˜ |
|------|--------|------|
| æ–‡æœ¬ | `text` | æ–‡æœ¬å†…å®¹ |
| æ–‡ä»¶ | `file` | æ–‡ä»¶/å›¾ç‰‡ |
| å·¥å…· | `tool` | å·¥å…·è°ƒç”¨ç»“æœ |
| äº¤äº’ | `interactive` | äº¤äº’èŠ‚ç‚¹ |
| æ¨ç† | `reasoning` | æ¨ç†è¿‡ç¨‹ |

## ğŸ”— ç›¸å…³èµ„æº

- [åº”ç”¨ç®¡ç†æ¨¡å—](../app-management/README.md)
- [å·¥ä½œæµæ¨¡å—åˆ†æ](../workflow/README.md)
- [çŸ¥è¯†åº“æ¨¡å—åˆ†æ](../knowledge-base/README.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2024-12-26  
**é€‚ç”¨ç‰ˆæœ¬**: FastGPT v4.9+
