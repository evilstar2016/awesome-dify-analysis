# 对象存储集成

## 概述

RAGFlow 支持多种对象存储服务用于存储文档、图片和其他二进制文件。系统提供统一的存储抽象层，支持在不同存储后端之间灵活切换。

## 支持的对象存储

### 1. MinIO (默认)

#### 配置

```yaml
# conf/service_conf.yaml
minio:
  user: minioadmin
  password: minioadmin  
  host: localhost:9001

# 环境变量
MINIO_USER=minioadmin
MINIO_PASSWORD=your_password
MINIO_HOST=localhost:9001
```

#### 连接实现

**核心文件**：[rag/utils/minio_conn.py](../../rag/utils/minio_conn.py)

```python
from minio import Minio

class RAGFlowMinio:
    def __init__(self, host, access_key, secret_key):
        self.client = Minio(
            host,
            access_key=access_key,
            secret_key=secret_key,
            secure=False
        )
```

**依赖**：`minio==7.2.4`

### 2. AWS S3

#### 配置

```yaml
s3:
  access_key: AKIAXXXXXXXX
  secret_key: xxxxxxxxxxxxx
  region: us-east-1
  bucket: my-bucket
```

**核心文件**：[rag/utils/s3_conn.py](../../rag/utils/s3_conn.py)

**依赖**：`mypy-boto3-s3==1.40.26`

### 3. Azure Blob Storage

#### SPN 认证

**核心文件**：[rag/utils/azure_spn_conn.py](../../rag/utils/azure_spn_conn.py)

#### SAS Token 认证

**核心文件**：[rag/utils/azure_sas_conn.py](../../rag/utils/azure_sas_conn.py)

**依赖**：
- `azure-identity==1.17.1`
- `azure-storage-file-datalake==12.16.0`

### 4. 阿里云 OSS

**核心文件**：[rag/utils/oss_conn.py](../../rag/utils/oss_conn.py)

### 5. Google Cloud Storage

**核心文件**：[rag/utils/gcs_conn.py](../../rag/utils/gcs_conn.py)

### 6. OpenDAL (统一数据访问层)

OpenDAL 提供统一接口访问多种存储后端。

**核心文件**：[rag/utils/opendal_conn.py](../../rag/utils/opendal_conn.py)

**依赖**：`opendal>=0.45.0`

## 使用示例

### MinIO 基础操作

```python
from rag.utils.minio_conn import RAGFlowMinio

# 连接 MinIO
minio_client = RAGFlowMinio(
    host="localhost:9001",
    access_key="minioadmin",
    secret_key="minioadmin"
)

# 创建 bucket
if not minio_client.client.bucket_exists("my-bucket"):
    minio_client.client.make_bucket("my-bucket")

# 上传文件
minio_client.client.fput_object(
    bucket_name="my-bucket",
    object_name="doc.pdf",
    file_path="/path/to/doc.pdf"
)

# 下载文件
minio_client.client.fget_object(
    bucket_name="my-bucket",
    object_name="doc.pdf",
    file_path="/tmp/doc.pdf"
)

# 删除文件
minio_client.client.remove_object(
    bucket_name="my-bucket",
    object_name="doc.pdf"
)
```

## Docker 部署

```yaml
# docker-compose.yml
minio:
  image: minio/minio:latest
  command: server /data --console-address ":9001"
  ports:
    - "9000:9000"
    - "9001:9001"
  environment:
    MINIO_ROOT_USER: minioadmin
    MINIO_ROOT_PASSWORD: minioadmin
  volumes:
    - minio_data:/data
```

## 参考文档

- [MinIO 文档](https://min.io/docs)
- [AWS S3 文档](https://docs.aws.amazon.com/s3/)
- [Azure Blob 文档](https://docs.microsoft.com/azure/storage/blobs/)

## 许可证

遵循项目主许可证 [Apache 2.0](../../LICENSE)
