# 系统架构（System Architecture）

> 🏗️ Dify 系统级架构设计与组件关系分析

## 📋 目录概览

本目录包含 Dify 的**完整系统架构**设计文档和架构图，帮助你从宏观层面理解 Dify 的整体设计。

### 📄 核心文档

- **`dify_componet_architecture.puml`** - Dify 完整组件架构（PlantUML 源文件）
  - 前端层：Next.js + React 架构
  - 后端层：Flask + DDD 分层设计
  - 核心模块：Workflow、Agent、RAG、Model Runtime 等
  - 基础设施：数据库、缓存、消息队列等
  - 第三方集成：LLM、向量数据库、对象存储等

### 🖼️ 架构图库（png/）

本目录包含 **9 张高清架构图**，涵盖完整系统和核心场景：

#### 系统级架构图
1. **`Dify完整组件架构图.png`** ⭐
   - Dify 的完整技术架构
   - 前端、后端、基础设施三层结构
   - 核心模块和依赖关系
   - 适合：技术选型、系统理解、团队分享

2. **`Dify智能体技术组件架构图.jpg`**
   - Agent 系统的技术组件
   - 策略模式设计
   - 工具调用与记忆管理
   - 适合：理解 Agent 架构

#### 核心场景时序图
3. **`Dify工作流管理核心场景时序图.png`**
   - 工作流创建、编排、执行流程
   - 前后端交互时序
   - 数据库操作流程

4. **`Dify智能体核心场景时序.png`**
   - Agent 执行的完整时序
   - 工具调用流程
   - 多轮对话管理

#### 文档处理流程图
5. **`Dify-PDF文档处理时序.png`**
   - PDF 文档的上传、解析、分片、向量化流程

6. **`Dify-Word文档处理时序.png`**
   - Word 文档的处理流程

7. **`Dify-Excel文档处理时序.png`**
   - Excel 文档的处理流程

8. **`Dify-Notion文档处理时序.png`**
   - Notion 文档的导入流程

9. **`Dify-在线文档导入流程.png`**
   - 通过 URL 导入在线文档的流程

## 🎯 架构设计核心要点

### 1. 分层架构（Layered Architecture）

```
┌─────────────────────────────────┐
│  前端层（Frontend Layer）        │
│  Next.js 15 + React 19          │
├─────────────────────────────────┤
│  API 网关层（API Gateway）       │
│  Flask + RESTful API            │
├─────────────────────────────────┤
│  业务逻辑层（Business Layer）    │
│  DDD + Clean Architecture       │
├─────────────────────────────────┤
│  数据访问层（Data Layer）        │
│  Repository Pattern             │
├─────────────────────────────────┤
│  基础设施层（Infrastructure）    │
│  PostgreSQL + Redis + Celery    │
└─────────────────────────────────┘
```

### 2. 核心模块

- **Workflow 工作流引擎**：可视化编排与执行
- **Agent 智能体系统**：多策略 Agent 实现
- **RAG 管道**：从摄取到检索的完整链路
- **Model Runtime**：统一的多模型抽象层
- **Knowledge Base**：知识库与向量检索
- **Observability**：日志、追踪、监控

### 3. 技术选型

| 层级 | 技术栈 | 说明 |
|------|--------|------|
| 前端 | Next.js 15 + React 19 | App Router 架构 |
| 后端 | Flask 3.1 + Python 3.11 | 轻量级 Web 框架 |
| 架构模式 | DDD + Clean Architecture | 领域驱动设计 |
| 数据库 | PostgreSQL 15+ | 关系型数据库 |
| 缓存 | Redis 7+ | 内存数据库 |
| 任务队列 | Celery + Redis | 异步任务处理 |
| 向量数据库 | Weaviate（默认） | 支持 28+ 种 |

### 4. 设计原则

- ✅ **开闭原则**：易于扩展，不需修改现有代码
- ✅ **单一职责**：每个模块职责清晰
- ✅ **依赖倒置**：依赖抽象而非具体实现
- ✅ **接口隔离**：最小化接口依赖
- ✅ **组合优于继承**：灵活的功能组合

## 📖 如何使用这些资源

### 对于架构师
1. 查看 **完整组件架构图** 理解整体设计
2. 阅读 **PlantUML 源文件** 了解模块关系
3. 参考设计模式进行技术选型

### 对于开发者
1. 查看 **时序图** 理解具体流程
2. 根据架构图定位代码位置
3. 理解模块间的交互方式

### 对于技术决策者
1. 评估技术栈的成熟度
2. 了解系统的可扩展性
3. 评估部署和运维复杂度

## 🔍 查看架构图的工具

### 在线查看
- **PNG 图片**：直接用图片查看器打开
- **GitHub**：在 GitHub 上直接预览

### 编辑 PlantUML
- **VS Code 插件**：PlantUML 扩展
- **在线工具**：[PlantUML Web Server](http://www.plantuml.com/plantuml)
- **本地工具**：Graphviz + PlantUML

## 📚 相关文档

- [01-overview](../01-overview/) - 项目概述
- [03-layers/api](../03-layers/api/) - API 层设计详解
- [04-core-modules](../04-core-modules/) - 核心模块深度分析
- [05-data-architecture](../05-data-architecture/) - 数据架构设计

---

## 📖 深入理解设计思想

本文档提供了 Dify 的**完整架构图和设计说明**。

想深入理解 **"为什么这样设计"** ？我们定期发布：

### 🤔 设计分析系列
- **架构演进**：Dify 架构从 v0.1 到 v1.0 的演进历程
- **DDD 分层**：为什么选择领域驱动设计？如何划分边界？
- **技术选型**：Flask vs FastAPI，PostgreSQL vs MongoDB
- **微服务化**：Dify 为什么没有采用微服务架构？

### 🛠️ 实战经验系列
- **高可用部署**：生产环境的架构部署方案
- **性能优化**：从单机到分布式的性能提升
- **监控告警**：完整的可观测性体系搭建
- **容器化部署**：Docker + K8s 的最佳实践

📱 **关注公众号「柒叔代码阁」**

回复 **"架构设计"** 或 **"DDD"** 获取完整深度内容

![公众号二维码](../qrcode.png)

---

💡 **为什么关注？**

不只是告诉你"是什么"和"怎么做"，更重要的是 **"为什么"** — 理解设计背后的思想，才能举一反三。

💬 **交流讨论**
- GitHub Issue/Discussion：技术问题讨论
- 公众号留言：一对一答疑
